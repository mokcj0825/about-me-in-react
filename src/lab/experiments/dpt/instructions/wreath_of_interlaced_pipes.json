{
  "id": "wreath_of_interlaced_pipes_test",
  "name": "Wreath of Interlaced Pipes Survival Test",
  "description": "Demonstrates the survival mechanism of Wreath of Interlaced Pipes blessing",
  "setup": {
    "blessings": ["wreath_of_interlaced_pipes"],
    "player_units": [
      {
        "id": "player_1",
        "name": "Test Subject A",
        "hp": 1000,
        "maxHp": 1000,
        "energy": 100,
        "maxEnergy": 200,
        "spd": 100
      },
      {
        "id": "player_2",
        "name": "Test Subject B",
        "hp": 1000,
        "maxHp": 1000,
        "energy": 100,
        "maxEnergy": 200,
        "spd": 100
      }
    ],
    "enemy_units": [
      {
        "id": "enemy_1",
        "name": "Damage Dealer A",
        "hp": 1000,
        "maxHp": 1000,
        "attack": 99999,
        "target_type": "single",
        "spd": 200
      },
      {
        "id": "enemy_2",
        "name": "Damage Dealer B",
        "hp": 1000,
        "maxHp": 1000,
        "attack": 99999,
        "target_type": "single",
        "spd": 200
      }
    ]
  },
  "test_sequence": [
    {
      "step": 1,
      "expected_actor": "enemy_1",
      "action": {
        "type": "attack",
        "description": "Enemy A deals fatal damage to a random player unit (acts first due to higher speed)",
        "expected_result": [
          "Target unit should not be knocked out",
          "Target unit's energy should be consumed",
          "Target unit should recover HP equal to 50% of consumed energy",
          "Blessing effect should be marked as used for the team"
        ]
      }
    },
    {
      "step": 2,
      "expected_actor": "enemy_2",
      "action": {
        "type": "attack",
        "description": "Enemy B deals fatal damage to random player unit (acts second due to same speed as Enemy A)",
        "expected_result": [
          "Target unit should be knocked out (blessing already used)",
          "No energy consumption or HP recovery should occur"
        ]
      }
    },
    {
      "step": 3,
      "expected_actor": "player_1",
      "action": {
        "type": "wait",
        "description": "Player unit A's turn (if survived)",
        "expected_result": [
          "Unit should be alive if it was the first target",
          "HP should be equal to 50% of consumed energy"
        ]
      }
    },
    {
      "step": 4,
      "expected_actor": "player_2",
      "action": {
        "type": "wait",
        "description": "Player unit B's turn (if survived)",
        "expected_result": [
          "Unit should be alive if it was the first target",
          "HP should be equal to 50% of consumed energy"
        ]
      }
    }
  ],
  "validation": {
    "success_conditions": [
      "First player unit survives with HP = (consumed_energy * 0.5)",
      "Second player unit is knocked out",
      "Blessing effect is consumed",
      "Turn order follows speed values (enemy units act first)"
    ],
    "edge_cases": [
      "If both units are hit simultaneously, only one should receive the blessing effect",
      "The blessing effect should not trigger again in the same battle",
      "Turn order should be: Enemy A -> Enemy B -> Player A/B -> Player B/A"
    ]
  }
}
