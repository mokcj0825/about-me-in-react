{
  "id": "garment_of_coiled_wires_test",
  "name": "Garment of Coiled Wires Recovery Test",
  "description": "Demonstrates the HP recovery mechanism of Garment of Coiled Wires blessing after ultimate cast",
  "rarity": 1,
  "category": "defense",
  "implementation": {
    "data_structures": {
      "recovery_effect": {
        "id": "garment_recovery",
        "type": "heal_trigger",
        "heal_amount": 16,
        "heal_type": "percentage_max_hp",
        "trigger": "after_ultimate"
      },
      "event_types": [
        "ability_used",
        "ultimate_used",
        "hp_recovered",
        "blessing_triggered"
      ],
      "required_interfaces": {
        "AbilityHandler": {
          "methods": [
            "isUltimateAbility(ability: Ability): boolean",
            "handleAbilityUsed(actor: Unit, ability: Ability, targets: Unit[]): void"
          ]
        },
        "BlessingManager": {
          "methods": [
            "hasBlessing(unit: Unit, blessingId: string): boolean",
            "triggerBlessing(unit: Unit, blessingId: string): void"
          ]
        },
        "ResourceManager": {
          "methods": [
            "recoverHp(unit: Unit, amount: number): number",
            "calculateMaxHpPercentage(unit: Unit, percentage: number): number"
          ]
        }
      }
    },
    "event_flow": [
      {
        "trigger": "ability_used",
        "checks": [
          "Is ability an ultimate?",
          "Does user have garment_of_coiled_wires blessing?"
        ],
        "actions": [
          "Calculate heal amount (16% of max HP)",
          "Apply heal to ability user",
          "Emit blessing_triggered event",
          "Emit hp_recovered event"
        ]
      }
    ],
    "pseudocode": {
      "ultimate_handling": [
        "function handleAbilityUsed(event: AbilityUsedEvent) {",
        "  if (!abilityHandler.isUltimateAbility(event.ability)) return;",
        "  if (!blessingManager.hasBlessing(event.actor, 'garment_of_coiled_wires')) return;",
        "  ",
        "  const healAmount = resourceManager.calculateMaxHpPercentage(event.actor, 16);",
        "  const healedAmount = resourceManager.recoverHp(event.actor, healAmount);",
        "  ",
        "  blessingManager.triggerBlessing(event.actor, 'garment_of_coiled_wires');",
        "  emitEvent('blessing_triggered', { target: event.actor, blessing: 'garment_of_coiled_wires' });",
        "  emitEvent('hp_recovered', { target: event.actor, amount: healedAmount });",
        "}"
      ]
    }
  },
  "validation": {
    "success_conditions": [
      "Player unit's energy is fully consumed (0/120) after ultimate",
      "Player unit's HP increases by 16% of max HP when ultimate is used",
      "Blessing effect triggers immediately after ultimate cast",
      "Blessing persists across turns and can trigger multiple times"
    ],
    "edge_cases": [
      "Blessing should trigger even if unit is at full HP",
      "HP recovery should not exceed maxHp",
      "HP recovery amount is based on maxHp, not current HP",
      "Blessing should work for all player units",
      "Blessing should trigger every time an ultimate is used"
    ]
  }
}
